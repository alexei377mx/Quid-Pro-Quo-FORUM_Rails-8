<div class="box">
  <%= form_with url: admin_path, method: :get, local: true do %>
    <input type="hidden" name="tab" value="reports">

    <div class="columns is-multiline">
      <div class="column is-one-quarter">
        <label class="label">Tipo de contenido</label>
        <div class="select is-fullwidth">
          <%= select_tag :type, options_for_select([["Todos", ""], ["Post", "Post"], ["Comentario", "Comment"]], selected: params[:type]), class: "select" %>
        </div>
      </div>

      <div class="column is-one-quarter">
        <label class="label">Estado</label>
        <div class="select is-fullwidth">
          <%= select_tag :reviewed, options_for_select([["Todos", ""], ["Revisados", "true"], ["No revisados", "false"]], selected: params[:reviewed]), class: "select" %>
        </div>
      </div>

      <div class="column is-one-quarter">
        <label class="label">Desde</label>
        <%= date_field_tag :from, params[:from], class: "input" %>
      </div>

      <div class="column is-one-quarter">
        <label class="label">Hasta</label>
        <%= date_field_tag :to, params[:to], class: "input" %>
      </div>

      <div class="column is-full">
        <%= submit_tag "Filtrar", class: "button is-primary" %>
        <%= link_to "Limpiar", admin_path(tab: "reports"), class: "button is-light" %>
      </div>
    </div>
  <% end %>
</div>

<div class="table-container">
  <table class="table is-fullwidth is-striped is-hoverable">
    <thead>
      <tr>
        <th>Usuario</th>
        <th>Razón</th>
        <th>Contenido</th>
        <th>Tipo</th>
        <th>Fecha</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody>
      <% @reports.each do |report| %>
        <tr id="report_<%= report.id %>">
          <td><%= report.user.username %></td>
          <td><%= report.reason %></td>
          <td>
            <% if report.reportable_type == "Post" %>
              <%= link_to truncate(report.reportable.title, length: 30), post_path(report.reportable), class: "has-text-link" %>
            <% elsif report.reportable_type == "Comment" %>
              <%= link_to truncate(report.reportable.content, length: 50), post_path(report.reportable.post), class: "has-text-link" %>
            <% end %>
          </td>
          <td><%= report.reportable_type == "Post" ? "Post" : "Comentario" %></td>
          <td><%= l(report.created_at, format: :short) %></td>
          <td>
            <% button_class = "button is-small is-#{report.reviewed ? 'success' : 'warning'}" %>
            <%= button_to toggle_reviewed_admin_report_path(report),
                          method: :patch,
                          params: { 
                            type: params[:type],
                            reviewed: params[:reviewed],
                            from: params[:from],
                            to: params[:to],
                            page: params[:page]
                          },
                          form: { data: { turbo_confirm: "¿Cambiar estado de revisión?" } },
                          class: "button is-small is-#{report.reviewed ? 'success' : 'warning'}" do %>
                          <%= report.reviewed ? "Revisado" : "No revisado" %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
<div class="container">
  <%= paginate @reports %>
</div>
