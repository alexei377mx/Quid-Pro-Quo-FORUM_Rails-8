<section class="section">
  <div class="container">
    <div class="content">
      <h1 class="title is-2"><%= @post.title %></h1>
      <br>
      <div class="subtitle is-6 has-text-grey mb-5">
        <span class="icon-text">
          <span class="icon"><i class="fa-solid fa-user"></i></span>
          <span>Publicado por <strong><%= @post.user.name %></strong></span>
        </span>
        <span class="icon-text ml-4">
          <span class="icon"><i class="fa-solid fa-calendar-days"></i></span>
          <span>hace <%= time_ago_in_words(@post.created_at) %></span>
        </span>
        <% if @post.updated_at > @post.created_at %>
          <span class="icon-text ml-4">
            <span class="icon"><i class="fa-solid fa-pen-to-square"></i></span>
            <span>Editado hace <%= time_ago_in_words(@post.updated_at) %></span>
          </span>
        <% end %>
      </div>

      <% if user_signed_in? && @post.user == current_user %>
        <div class="buttons are-small">
          <%= link_to edit_post_path(@post), class: "button is-warning" do %>
            <span class="icon"><i class="fa-solid fa-pen-to-square"></i></span>
            <span>Editar</span>
          <% end %>
        </div>
      <% end %>

      <hr>
      <div class="box">
        <div class="content post-content">
          <%= simple_format(@post.content) %>
        </div>
      </div>

      <div class="comments mt-5">
        <h2 class="subtitle is-4"><i class="fa-solid fa-comments"></i> Comentarios</h2>

        <% if @post.comments.order(created_at: :desc).any? %>
          <% @post.comments.order(created_at: :desc).each do |comment| %>
            <%= render partial: "comments/comment", locals: { comment: comment, post: @post } %>
          <% end %>
        <% else %>
          <p><i class="fa-solid fa-circle-info"></i> No hay comentarios aún.</p>
        <% end %>

        <% if user_signed_in? %>
          <article class="media">
            <figure class="media-left">
              <p class="image is-64x64">
                <img src="https://bulma.io/assets/images/placeholders/128x128.png" />
              </p>
            </figure>
            <div class="media-content">
              <%= form_with(model: [ @post, (@comment || @post.comments.build) ], local: true) do |form| %>
                <div class="field">
                  <%= form.label :content, class: "label" do %>
                    <span class="icon-text">
                      <span class="icon"><i class="fa-solid fa-comment"></i></span>
                      <span>Comentario</span>
                    </span>
                  <% end %>
                  <div class="control">
                    <%= form.text_area :content, class: "textarea #{(@comment && @comment.errors[:content].any?) ? 'is-danger' : ''}", placeholder: "Agregar un comentario..." %>
                  </div>
                  <small class="help is-danger"><%= (@comment && @comment.errors[:content].join(', ')) %></small>
                </div>
                <div class="field">
                  <p class="control">
                    <%= form.submit class: "button is-info" do %>
                      <i class="fa-solid fa-paper-plane"></i> Publicar comentario
                    <% end %>
                  </p>
                </div>
              <% end %>
            </div>
          </article>
        <% else %>
          <p><%= link_to "<i class='fa-solid fa-right-to-bracket'></i> Inicia sesión".html_safe, login_path, data: { turbo: false } %> para dejar un comentario.</p>
        <% end %>
      </div>
    </div>
  </div>
</section>